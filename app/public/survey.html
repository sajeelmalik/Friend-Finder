<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Friend Finder</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.14/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.14/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.14/js/uikit-icons.min.js"></script>

    <!-- Semantic UI  -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.3/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.3/dist/semantic.min.js"></script> -->

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

    <!-- Google Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Oswald:700|Droid+Serif:400,700italic" rel="stylesheet" type="text/css"
    />

    <link rel="stylesheet" href="style.css">

</head>

<body>

    <div class="jumbotron jumbotron-fluid uk-animation-slide-top-small">
        <div class="container">
            <h1 class="text-center display-4">Compatibility Survey</h1>
            <hr>
            <p class="text-center">Fill in the survey to find your most suitable match!</p>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h3>Profile Info</h3>
            </div>
            <div class="card-body">
                <h5 class="card-title">Enter some basic information so we can get to know you!</h5>
                <form>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon1">Name:</span>
                        </div>
                        <input type="text" class="form-control" placeholder="Mark Zuckerberg" aria-label="name" aria-describedby="basic-addon1" id="username"
                            required>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon1">Image URL:</span>
                        </div>
                        <input type="text" class="form-control" placeholder="Link an image of you!" aria-label="image" aria-describedby="basic-addon1"
                            id="userImage" required>
                    </div>

                    <footer class="blockquote-footer" id="requiredMessage">Required</footer>
                    <br>
                    <button type="button" class="btn btn-outline-primary btn-large btn-block" id="profileInfo">Submit</button>
                </form>
            </div>


        </div>
        <br>
        <div class="card uk-animation-fade" id="survey" style="display:none">
            <div class="card-header">
                <h3>Survey</h3>
            </div>
            <div class="card-body" uk-scrollspy="target: > h3, h4; cls:uk-animation-fade; delay: 200">
                <h5 class="card-title">Complete the following questions to the best of your ability!</h5>
                <hr class="uk-divider-icon uk-animation-scale-up">
                <h3><strong>Question 1</strong></h3>
                <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question1" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question1" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question1" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question1" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question1" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>
                <hr>
                <h3><strong>Question 2</strong></h3>
                <h4>Generally speaking, you rely more on your experience than your imagination.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question2" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question2" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question2" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question2" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question2" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>
                <hr>


                <h3><strong>Question 3</strong></h3>
                <h4>You find it easy to stay relaxed and focused even when there is some pressure.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question3" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question3" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question3" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question3" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question3" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>

                <hr>

                <h3><strong>Question 4</strong></h3>
                <h4>You rarely do something just out of sheer curiosity.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question4" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question4" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question4" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question4" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question4" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>

                <hr>

                <h3><strong>Question 5</strong></h3>
                <h4>People can rarely upset you.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question5" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question5" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question5" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question5" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question5" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>

                <hr>

                <h3><strong>Question 6</strong></h3>
                <h4>It is often difficult for you to relate to other people’s feelings.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question6" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question6" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question6" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question6" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question6" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>
                <hr>


                <h3><strong>Question 7</strong></h3>
                <h4>In a discussion, truth should be more important than people’s sensitivities.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question7" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question7" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question7" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question7" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question7" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>
                <hr>

                <h3><strong>Question 8</strong></h3>
                <h4>You rarely get carried away by fantasies and ideas.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question8" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question8" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question8" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question8" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question8" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>
                <hr>

                <h3><strong>Question 9</strong></h3>
                <h4>You think that everyone’s views should be respected regardless of whether they are supported by facts
                    or not.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question9" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question9" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question9" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question9" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question9" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>
                <hr>

                <h3><strong>Question 10</strong></h3>
                <h4>You feel more energetic after spending time with a group of people.</h4>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-danger disabled">Strongly Disagree</button>
                    <label class="btn btn-info">
                        <input type="radio" name="question10" value="1" autocomplete="off"> 1
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question10" value="2" autocomplete="off"> 2
                    </label>
                    <label class="btn btn-info active">
                        <input type="radio" name="question10" value="3" autocomplete="off" checked> 3
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question10" value="4" autocomplete="off"> 4
                    </label>
                    <label class="btn btn-info">
                        <input type="radio" name="question10" value="5" autocomplete="off"> 5
                    </label>
                    <button class="btn btn-success disabled">Strongly Agree</button>
                </div>
                <br><br>
                <button type="button" class="btn btn-outline-primary btn-large btn-block" id="surveyInfo" data-toggle="modal" data-target="#friendModal">Find
                    Friends!
                </button>
            </div>

        </div>



    </div>

    <!-- Modal for best match -->
    <div class="modal fade" id="friendModal" tabindex="-1" role="dialog" aria-labelledby="friendModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="friendModalLabel">Here's your best match!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <img id="matchedProfile">
                    <h3>Name: <span id="matchedName"></span></h3>
                    <h4>Compatibility Rating: <span id="matchedRating"></span></h4>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Decline</button>
                    <button type="button" class="btn btn-success" id="makeFriends" data-dismiss="modal" data-toggle="modal" data-target="#newFriends">Make
                        Friends
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal for friend pairing -->
    <div class="modal fade" id="newFriends" tabindex="-1" role="dialog" aria-labelledby="friendModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-body container-fluid">
                        <div class="row">
                            <h3 class="modal-title" id="friendModalLabel">Here's your best match!</h3>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="row">
                            <h2 class="alert alert-success text-center">Compatibility Rating: <span id="matchedRating2"></span></h2>
                            <div class="col-lg-6">
                                <img id="profile">
                                <h3><span id="name"></span></h3>
                            </div>
                            <div class="col-lg-6">
                                <img id="matchedProfile2">
                                <h3><span id="matchedName2"></span></h3>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        //initiate a new user 
        var user = {};

        var matchedPerson = "";
        var matchedImg = "";
        var rating = 0;

        //on-click of the profile info, the survey appears and the user's name and photo are stored
        $(document).on("click", "#profileInfo", function (event) {


            if ($("#username").val() && $("#userImage").val()) {
                event.preventDefault();
                // $("#survey").addClass("uk-animation-fade");
                $("#survey").show();
                user.name = $("#username").val().trim();
                user.photo = $("#userImage").val().trim();
                $("#profileInfo").addClass("disabled");

                $("#profile").attr("src", user.photo);
                $("#name").text(user.name);
                //prepare empty array for user scores that will be filled out on the survey area
                $("#requiredMessage").text("SUCCESS!");
                $("#requiredMessage").addClass("alert alert-success");
                $("#requiredMessage").css("font-size", "20px");
                $("#requiredMessage").css("transition", "0.3s ease");

                console.log(user);
            }
            else {
                $("#requiredMessage").text("You must input these fields to continue!");
                $("#requiredMessage").addClass("alert alert-danger");
                $("#requiredMessage").css("font-size", "20px");
                $("#requiredMessage").css("transition", "0.3s ease");
                

            }

        });

        $(document).on("click", "#surveyInfo", function (event) {
            event.preventDefault();

            user.scores = [];
            //iterate through questions and obtain the values of each checked radio button. Here, it becomes clearer that radio buttons are not the most effective way to store this information - they're too complicated, irregular, and just DIRTY
            for (var i = 1; i < 11; i++) {
                var choice = parseInt($("input[type='radio'][name='question" + i + "']:checked").val());
                user.scores.push(choice);
            }

            //initialize rating at 40 - the highest possible difference
            rating = 40;

            //calculates the individual absolute value difference between each of the user's inputs and each of the inputs of those already in the array. For this simple case, one could simply compare the total values of all 10 questions, but the implementation below leaves room for further updates in which individual questions are weighted more heavily
            $.get("/api/friends/", function (friends) {
                console.log(friends);
                friends.forEach(function (elem) {
                    console.log(elem);
                    var tempRating = 0;
                    for (var i = 0; i < elem.scores.length; i++) {
                        tempRating += Math.abs(elem.scores[i] - user.scores[i]);
                    }
                    console.log(tempRating);

                    //continually checks to see if we're receiving a better rating
                    if (tempRating < rating) {
                        rating = tempRating;
                        matchedPerson = elem.name;
                        matchedImg = elem.photo;
                    }
                })
            }).then(function (res) {
                $.post("/api/friends/", user, function (response) {
                    $("#matchedProfile").attr("src", matchedImg);
                    $("#matchedProfile2").attr("src", matchedImg);
                    $("#matchedName").text(matchedPerson);
                    $("#matchedName2").text(matchedPerson);
                    $("#matchedRating").text(Math.ceil((40 - rating) / 40 * 100) + "%");
                    $("#matchedRating2").text(Math.ceil((40 - rating) / 40 * 100) + "%");
                })
            })


        })
    </script>
</body>

</html>